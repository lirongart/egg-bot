# 📦 Changelog – EggBot PRO v2.0.0

> תאריך שחרור: 2025-04-14  
> סטטוס: ✅ גרסה יציבה

---

## 🔧 שיפורי ליבה

- ✅ מעבר למבנה מודולרי מלא: `handlers/`, `utils/`, `keyboards/`.
- ✅ הפרדת אחריות ברורה בין משתמש רגיל למנהל.
- ✅ רישום פקודות באופן מרוכז לכל קבוצה.
- ✅ תמיכה מלאה בשפות RTL (עברית) עם אימוג׳ים מותאמים.

---

## 💳 מודול הפקדה חכם (bit)

- ✅ עיבוד אוטומטי של הודעות SMS מהאפליקציית bit.
- ✅ זיהוי שם, סכום וקישור מתוך ההודעה.
- ✅ עדכון יתרת המשתמש, לוג לתיעוד, והודעה חוזרת.
- ✅ הגנה על כפילות קישור.
- ✅ שימוש במיפוי שמות בטבלת `bit_users`.

---

## 🤖 שיפורים עבור מנהל המערכת

- ✅ תפריט אינטראקטיבי ייעודי עם כפתורים אינליין.
- ✅ כפתור `פקודות נוספות` עם כל הפקודות שלא בתפריט הראשי.
- ✅ אספקה בודדת / גורפת.
- ✅ ביטול הזמנה בודדת / גורפת.
- ✅ לוג מפורט לכל פעולה.

---

## 📈 QA ואוטומציה

- ✅ סקריפט בדיקות אוטומטיות ב־`Telethon` עם תמיכה בסימולציית משתמשים מרובים.
- ✅ רישום תוצאות ל־Google Sheets.
- ✅ בדיקות מיוחדות: אספקה חלקית, ביטול, יתרה שלילית, הזמנה במצב ללא מספיק כסף ועוד.

---

## 💾 ניהול מסד נתונים

- ✅ שימוש ב־`PostgreSQL` בענן Render.
- ✅ שימוש ב־`execute_query` ו־`get_db_connection` לביצוע שאילתות בטוחות.
- ✅ מאגר חיבורים (`ThreadedConnectionPool`) למניעת התנגשויות.
- ✅ טיפול בטרנזקציות עם `BEGIN / COMMIT / ROLLBACK`.

---

## 🔒 אבטחה

- ✅ סניטיזציה מלאה לשמות משתמשים (`sanitize_name`).
- ✅ וולידציה לכמויות ומידות (`validate_quantity`, `validate_size`).
- ✅ דקורטור אחיד לכל טיפול שגיאות: `@safe_execution(...)`.
- ✅ נעילת פעולות רגישות לפי משתמש: `@user_lock`.

---

## 🧪 בדיקות ובאגים שתוקנו

- 🐛 בעיה בזיהוי המנהל דרך `ADMIN_ID` – טופלה.
- 🐛 כפילות בקוד סיכום כללי – סודרה.
- 🐛 מקרים של קריסות `datetime not defined` – טופלו.
- 🐛 שגיאה בקריאת שמות מתוך הודעות bit – נוקתה והוספה הגנה מוקדמת.

---
